<!DOCTYPE html>
<html lang="en">
<head>
<title>Germplasm</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter2/1.3.14/crossfilter.min.js"></script>
    <script src="http://d3js.org/d3.v3.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.0.0-beta.31/dc.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/colreorder/1.3.2/js/dataTables.colReorder.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.2.0/js/dataTables.select.min.js"></script>
    <script src="https://rawgit.com/legumeinfo/lis-taxon-symbology/master/dist/bundle.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dc/2.0.0-beta.31/dc.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/colreorder/1.3.2/css/colReorder.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.2.0/css/select.dataTables.min.css">
</head>
<style>
  #germplasm-main
  {
    background-color: rgba(241,241,241, 0.8);
    margin-top:0.5em;
    padding-top:0.75em;
    overflow-x:auto;
  }
  #request-germplasm
  {
    margin:1.0em;
  }
  #germplasm-datatable
  {
    background-color: white;
  }
  #germplasm-jumbotron
  {
    background-color: rgba(125, 62, 188, 0.7);
    text-align: center; 
  }
  .jumbotron h1
  {
    color:white;
  }
  table tbody tr.even
  {
    background-color: rgba(125, 62, 188, 0.12);
  }
  #main-nav-right
  {
    margin-right: 0.5em;
  }
  #main-nav-left
  {
    margin-left: 1.0em
  }
  #main-nav-subtext
  {
    color: rgba(087, 087, 087, 1);
  }
  .dropdown-elements:hover
  {
    color: rgba(087, 087, 087, 1);
  }
  .btn-primary
  {
    background-color: rgba(125, 62, 188, 0.7);
  }
  .btn-primary:active
  {
    background-color: rgba(125, 62, 188, 0.9);
  }
  .btn-primary:hover
  {
    background-color: rgba(125, 62, 188, 0.9);
  }
  .btn-primary:focus
  {
    background-color: rgba(125, 62, 188, 0.9);
  }
  .btn-primary:disabled, .btn-primary:disabled:hover
  {
    background-color: grey;
  }
  .modal-dialog,
  .modal-content {
    height: 600px;
  }
  .modal-body {
    max-height: calc(100% - 120px);
    overflow: auto;
  }
  textarea.form-control
  {
    height: 480px;
  }
</style>
<body background="https://upload.wikimedia.org/wikipedia/commons/c/c6/Medicago_minima_eF.jpg">
<div class="container" id="germplasm-main">
        <nav class="navbar navbar-inverse" id="main-nav-navbar">
        <ul class="nav navbar-nav">
	    <li><a href="http://fisher.ncgr.org:50021"><b>Home</b></a></li>
	    <li><a href="http://fisher.ncgr.org:50021/germplasm"><b>Germplasm</b></a></li>
	    <li><a href="#"><b>BLAST</b></a></li></li>
	</ul>
        <ul class="nav navbar-nav navbar-right" id="main-nav-right">
            <li><a href="#"><b>Help</b></a></li>
            <li><a href="#"><b>About</b></a></li>
            <li><a href="#"><b>Links</b></a></li>
        </ul>
        </nav>

    <div class="jumbotron" id="germplasm-jumbotron">
        <h1 id="germplasm-header">Medicago Germplasm Listing</h1>
    </div>
        <table class="display table table-striped table-bordered" id="germplasm-datatable" width="100%">
            <thead>
                <tr>
                    <th></th>
                    <th>ID</th>
                    <th>Category</th>
                    <th>Population</th>
                    <th>Country</th>
                    <th>Seeds Origin</th>
                    <th>Seeds Available</th>
                    <th>Latitude</th>
                    <th>Longitude</th>
                </tr>
            </thead>
        </table>
        <button class="btn btn-primary" data-toggle="modal" id="request-germplasm" data-target="#request-form">Request Selected</button>
        <div id="request-form" class="modal fade" aria-labelledby="form-label" aria-hidden="true">
            <div class="modal-dialog">
              <div class="container-fluid">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                         <span aria-hidden="true">&times;</span>
                         <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="form-label">Enter Message and Click Submit</h4>
                  </div>
                  <div class="modal-body">
                      <form id="germplasm-mailer" action="http://fisher.ncgr.org:50021/germplasm-request" method="POST" enctype='multipart/form-data' encoding='multipart/form-data', target="_blank">
                          <div class="form-group">
                              <div class="col-sm-12">
                                  <label for="return-email-input">Your Email</label>
                                  <input type="text" class="form-control" id="return-email-input" name="return-email-input" placeholder="YOUR EMAIL HERE!"></input>
                              </div>
                              <div class="col-sm-12">
                                  <label for="email-message-input">Your Message</label>
                                  <textarea class="form-control" id="email-message-input" name="email-message-input" placeholder="YOUR MESSAGE HERE!"></textarea>
                              </div>
                          </div>   
                      </form> 
                  </div>
                  <div class="modal-footer">
                      <button type="submit" class="btn btn-primary" form="germplasm-mailer">submit</button>
                      <button padding-top="10px" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
        </div>
</div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('request-germplasm').disabled = true;
        var table = $('#germplasm-datatable').DataTable({
            'ajax' : {
                      'url': 'http://fisher.ncgr.org:50021/api/v1/germplasm'
                     },
            'columns' : [
                {'data': null, defaultContent: ""},
                {'data': 'hapmap_id'},
                {'data': 'category'},
                {'data': 'population_of_origin'},
                {'data': 'country_of_origin'},
                {'data': 'seeds_from'},
                {'data': 'seeds_available'},
                {'data': 'location_latitude'},
                {'data': 'location_longitude'}
            ],
            "bSortClasses" : false,
            "colReorder" : {
                fixedColumnsLeft: [1, 2]
            },
            "columnDefs": [{className: "select-checkbox", targets: 0}],
            "search": {
                "caseInsensitive": true,
                "regex": true
            },
            "select" : true,
            "order" : []
        });
        $('#germplasm-datatable tbody').on('click', 'tr', function(){
            var selected = table.rows('.selected').data();
            if (selected.length > 0){
              document.getElementById('request-germplasm').disabled = false;
            } else {
              document.getElementById('request-germplasm').disabled = true;
            }
        });
/*        document.getElementById('request-germplasm').addEventListener('click',
            function(){
                console.log('clicked me ' + table);
                var export_me = table.rows('.selected').data();
                var hapmap_ids = {'data': []};
                if (export_me.length > 0){
                    console.log(export_me);
                    for(var i=0;i < export_me.length;i++){
                        hapmap_ids['data'].push(export_me[i]['hapmap_id'].replace(/\s+/g, ''));
                    }
                    console.log(hapmap_ids);
                    xhr_post('http://fisher.ncgr.org:50021/germplasm-request', hapmap_ids);
                }
                return
        });*/
        /*document.getElementById('request-germplasm').addEventListener('submit')*/
    });
    function xhr_post(url, data){
        var xhr = new XMLHttpRequest();
        xhr.open('POST', url, true)
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var response_page = xhr.responseText;
                console.log(response_page);
                var new_page = window.open('', '_blank');
                console.log(new_page);
                new_page.document.write('<h1>' + response_page + '</h1>');
                new_page.stop()
                return
            }
        };
        xhr.send(JSON.stringify(data));
    }
    function alert_placeholder(){
        alert('Coming Soon!')
    }
</script>
</html>
